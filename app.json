{
  "id": "no.kjeet90.powerofthehour",
  "version": "0.0.1",
  "compatibility": ">=4.2.0",
  "sdk": 2,
  "name": {
    "en": "Power of the hour"
  },
  "brandColor": "#06bdd6",
  "description": {
    "en": "Notifies when power limits set by user is reached",
    "no": "Varsler når effektgrense satt av brukeren er nådd"
  },
  "category": [
    "energy"
  ],
  "permissions": [],
  "images": {
    "large": "/assets/images/large.png",
    "small": "/assets/images/small.png"
  },
  "author": {
    "name": "Kjetil Haugland",
    "email": "hauglandkjetil@gmail.com"
  },
  "flow": {
    "triggers": [
      {
        "id": "consumption_limit_reached",
        "title": {
          "en": "Consumption limit reached",
          "no": "Effektgrense nådd"
        },
        "tokens": [
          {
            "name": "consumption",
            "type": "number",
            "title": {
              "en": "Watt hours",
              "no": "Watt-timer"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "hour_reset",
        "title": {
          "en": "New hour started",
          "no": "Ny time startet"
        },
        "tokens": [],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "new_peak",
        "title": {
          "en": "New peak",
          "no": "Ny topp"
        },
        "tokens": [
          {
            "name": "peak",
            "type": "number",
            "title": {
              "en": "Watt",
              "no": "Watt"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "prediction_limit_reached",
        "title": {
          "en": "Prediction limit reached",
          "no": "Estimert grense nådd"
        },
        "tokens": [
          {
            "name": "predicted",
            "type": "number",
            "title": {
              "en": "Watt hours",
              "no": "Watt-timer"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "prediction_reset",
        "title": {
          "en": "Prediction notification reset",
          "no": "Estimertingsvarsel resatt"
        },
        "tokens": [
          {
            "name": "predicted",
            "type": "number",
            "title": {
              "en": "Watt hours",
              "no": "Watt-timer"
            },
            "example": {
              "en": "1500",
              "no": "1500"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      }
    ],
    "actions": [
      {
        "id": "consumption_updated",
        "title": {
          "en": "Update consumption",
          "no": "Oppdater forbruk"
        },
        "hint": {
          "en": "Set new consumption",
          "no": "Sett nytt forbruk"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          },
          {
            "name": "consumption",
            "type": "number",
            "title": {
              "en": "Watt",
              "no": "Watt"
            }
          }
        ]
      }
    ]
  },
  "drivers": [
    {
      "id": "power-of-the-hour",
      "name": {
        "en": "Power of the hour",
        "no": "Power of the hour"
      },
      "class": "sensor",
      "capabilities": [
        "consumption",
        "consumption_notified",
        "predictor",
        "prediction_notified",
        "consumption_peak",
        "consumption_previous_hour"
      ],
      "images": {
        "large": "/drivers/power-of-the-hour/assets/images/large.png",
        "small": "/drivers/power-of-the-hour/assets/images/small.png"
      },
      "icon": "/drivers/power-of-the-hour/assets/icon.svg",
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_my_devices"
          }
        },
        {
          "id": "add_my_devices",
          "template": "add_devices"
        }
      ],
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Consumption notification",
            "no": "Forbruksvarsel"
          },
          "children": [
            {
              "id": "consumption_limit",
              "type": "number",
              "label": {
                "en": "Notify at usage over (Wh)",
                "no": "Varsle ved forbruk over (Wt)"
              },
              "value": 4000,
              "hint": {
                "en": "Notifies if consumption (Watt hours) is exceeded before the set number of minutes have passed in the current hour",
                "no": "Varsler dersom forbruk (Watt-timer) er oversteget før satt antall minutter i den gjeldende timen har gått"
              }
            },
            {
              "id": "notification_consumption_time_earliest",
              "type": "number",
              "label": {
                "en": "Earliest after (minutes)",
                "no": "Tidligst etter (minutter)"
              },
              "value": 10,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "Notifies if consumption (Watt hours) is above limit, and the time is between the earliest/latest limit",
                "no": "Notifiserer dersom forbruk (Watt-timer) er over satt grense, og tidspunktet er mellom tidligst/senest grense"
              }
            },
            {
              "id": "notification_consumption_time_latest",
              "type": "number",
              "label": {
                "en": "Latest before (minutes)",
                "no": "Senest før (minutter)"
              },
              "value": 50,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "Notifies if consumption (Watt hours) is above limit, and the time is between the earliest/latest limit",
                "no": "Notifiserer dersom forbruk (Watt-timer) er over satt grense, og tidspunktet er mellom tidligst/senest grense"
              }
            },
            {
              "id": "notification_consumption_enabled",
              "type": "checkbox",
              "label": {
                "en": "Notification enabled",
                "no": "Varsling aktivert"
              },
              "value": true,
              "hint": {
                "en": "If enabled: notifies if consumption (Watt hours) is above limit, and the time is between the earliest/latest limit",
                "no": "Dersom aktivert: notifiserer dersom forbruk (Watt-timer) er over satt grense, og tidspunktet er mellom tidligst/senest grense"
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Prediction notification",
            "no": "Estimeringsvarsel"
          },
          "children": [
            {
              "id": "prediction_limit",
              "type": "number",
              "label": {
                "en": "Notify at prediction over (Wh)",
                "no": "Varsle ved estimat over (Wt)"
              },
              "value": 4000,
              "hint": {
                "en": "Notifies if prediction (Watt hours) is reached before the number of minutes have passed in the current hour",
                "no": "Notifiserer dersom estimert forbruk (Watt-timer) er nådd før antall minutter i den gjeldende timen har gått"
              }
            },
            {
              "id": "notification_prediction_time_earliest",
              "type": "number",
              "label": {
                "en": "Earliest after (minutes)",
                "no": "Tidligst etter (minutter)"
              },
              "value": 10,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "Notifies if predicted consumption (Watt hours) is above limit, and the time is between the earliest/latest limit",
                "no": "Notifiserer dersom estimert forbruk (Watt-timer) er over satt grense, og tidspunktet er mellom tidligst/senest grense"
              }
            },
            {
              "id": "notification_prediction_time_latest",
              "type": "number",
              "label": {
                "en": "Latest before (minutes)",
                "no": "Senest før (minutter)"
              },
              "value": 50,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "Notifies if predicted consumption (Watt hours) is above limit, and the time is between the earliest/latest limit",
                "no": "Notifiserer dersom estimert forbruk (Watt-timer) er over satt grense, og tidspunktet er mellom tidligst/senest grense"
              }
            },
            {
              "id": "notification_prediction_enabled",
              "type": "checkbox",
              "label": {
                "en": "Notification enabled",
                "no": "Varsling aktivert"
              },
              "value": true,
              "hint": {
                "en": "If enabled: notifies if predicted consumption (Watt hours) is above limit, and the time is between the earliest/latest limit",
                "no": "Dersom aktivert: notifiserer dersom estimert forbruk (Watt-timer) er over satt grense, og tidspunktet er mellom tidligst/senest grense"
              }
            },
            {
              "id": "prediction_reset_limit",
              "type": "number",
              "label": {
                "en": "Reset notification below (Wh)",
                "no": "Nullstill varsel under (Wt)"
              },
              "value": 2000,
              "min": 0,
              "step": 1,
              "hint": {
                "en": "Resets the prediction notification if the predicted consumption is below the limit (Watt hours)",
                "no": "Nullstiller estimeringsvarsel dersom estimert forbruk er under grensen (Watt-timer)"
              }
            },
            {
              "id": "prediction_reset_enabled",
              "type": "checkbox",
              "label": {
                "en": "Reset notification enabled",
                "no": "Nullstill varsel aktivert"
              },
              "value": false,
              "hint": {
                "en": "If enabled: Resets prediction notification if predicted consumption is below limit",
                "no": "Dersom aktivert: Nullstiller estimeringsvarsel dersom estimert forbruk er under grensen"
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Advanced",
            "no": "Avansert"
          },
          "children": [
            {
              "id": "prediction_type",
              "type": "dropdown",
              "label": {
                "en": "Prediction method",
                "no": "Estimeringsmetode"
              },
              "value": "time",
              "values": [
                {
                  "id": "time",
                  "label": {
                    "en": "Age (minutes)",
                    "no": "Alder (minutter)"
                  }
                },
                {
                  "id": "count",
                  "label": {
                    "en": "Count",
                    "no": "Antall"
                  }
                }
              ],
              "hint": {
                "en": "Select if the predictions should be done based on age of readings or a specific amount of readings",
                "no": "Velg om estimeringen skal gjøres basert på alder av avlesninger eller et spesifikt antall avlesninger"
              }
            },
            {
              "id": "prediction_age",
              "type": "number",
              "label": {
                "en": "Prediction",
                "no": "Estimering"
              },
              "value": 1,
              "min": 1,
              "max": 1000,
              "step": 1,
              "hint": {
                "en": "Maximum age or count of readings which are used for predicting the future consumption",
                "no": "Maksimale alderen eller antall av målinger som brukes for estimere fremtidig forbruk"
              }
            },
            {
              "id": "prediction_history_count",
              "type": "number",
              "label": {
                "en": "History",
                "no": "Historikk"
              },
              "value": 360,
              "min": 0,
              "max": 1000,
              "hint": {
                "en": "Maximum number of readings stored (used for prediction calculations). If you are not using the predictor you can set this to 0 to save memory. Example with storing 360 readings: If your device is updating every 5 seconds you would be able to predict based on 30 minutes of history. 5 seconds * 360  = 1800 seconds = 30 minutes.",
                "no": "Maksimalt antall avlesninger som lagres (brukt estimeringskalkulasjoner). Dersom du ikke bruker estimatoren kan denne settes til 0 for å spare minne. Eksempel med lagring av 360 avlesninger: Dersom enheten din oppdaterer hvert 5 sekund vil du kunne estimere basert på 30 minutters historikk. 5 sekund * 360  = 1800 sekunder = 30 minutter."
              }
            }
          ]
        }
      ]
    }
  ],
  "capabilities": {
    "consumption": {
      "title": {
        "en": "Consumption this hour",
        "no": "Forbruk denne timen"
      },
      "desc": {
        "en": "Shows consumption so far this hour",
        "no": "Viser forbruk så langt denne timen"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt hours",
            "no": "Watt-timer"
          },
          "example": {
            "en": 1200,
            "no": 1200
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "Wh",
        "no": "Wt"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/average.svg"
    },
    "consumption_notified": {
      "title": {
        "en": "Consumption warning sent",
        "no": "Forbruksvarsel sendt"
      },
      "desc": {
        "en": "Consumption warning has been triggered this hour",
        "no": "Forbruksvarsel har blitt aktivert denne timen"
      },
      "type": "boolean",
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/alert.svg"
    },
    "consumption_peak": {
      "title": {
        "en": "Peak this hour",
        "no": "Topp denne timen"
      },
      "desc": {
        "en": "Shows highest registered peak within this hour",
        "no": "Viser høyeste registrerte topp denne timen"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt",
            "no": "Watt"
          },
          "example": {
            "en": 1200,
            "no": 1200
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "W",
        "no": "W"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/maximum.svg"
    },
    "consumption_previous_hour": {
      "title": {
        "en": "Consumption previous hour",
        "no": "Forbruk forrige time"
      },
      "desc": {
        "en": "Shows previous hours consumption",
        "no": "Viser forrige times forbruk"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt hours",
            "no": "Watt-timer"
          },
          "example": {
            "en": 4500,
            "no": 4500
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "Wh",
        "no": "Wt"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/previous.svg"
    },
    "prediction_notified": {
      "title": {
        "en": "Prediction warning sent",
        "no": "Estimeringsvarsel sendt"
      },
      "desc": {
        "en": "Prediction warning has been sent this hour",
        "no": "Estimeringsadvarsel har blitt sendt denne timen"
      },
      "type": "boolean",
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/alert.svg"
    },
    "predictor": {
      "title": {
        "en": "Predicted consumption",
        "no": "Estimert forbruk"
      },
      "desc": {
        "en": "Shows predicted consumption based on past 100 readings",
        "no": "Viser estimert forbruk basert på siste 100 lesninger"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt hours",
            "no": "Watt-timer"
          },
          "example": {
            "en": 1200,
            "no": 1200
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "Wh",
        "no": "Wt"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/predicted.svg"
    }
  }
}