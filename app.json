{
  "_comment": "This file is generated. Please edit .homeycompose/app.json instead.",
  "id": "no.kjeet90.powerofthehour",
  "version": "0.2.0",
  "compatibility": ">=5.0.0",
  "sdk": 3,
  "name": {
    "en": "Power of the hour"
  },
  "brandColor": "#06bdd6",
  "description": {
    "en": "Keep your energy consumption below your desired limit"
  },
  "category": [
    "energy"
  ],
  "permissions": [],
  "images": {
    "large": "/assets/images/large.png",
    "small": "/assets/images/small.png",
    "xlarge": "/assets/images/xlarge.png"
  },
  "source": "https://github.com/kjeet90/homey-power-of-the-hour",
  "bugs": {
    "url": "https://github.com/kjeet90/homey-power-of-the-hour/issues"
  },
  "support": "mailto:hauglandkjetil@gmail.com",
  "contributing": {
    "donate": {
      "paypal": {
        "username": "kjetilhaugland"
      }
    }
  },
  "author": {
    "name": "Kjetil Haugland",
    "email": "hauglandkjetil@gmail.com"
  },
  "flow": {
    "triggers": [
      {
        "id": "consumption_limit_reached",
        "title": {
          "en": "Consumption notification trigged",
          "no": "Forbruksvarsel trigget"
        },
        "hint": {
          "en": "This card triggers when the actial consumption has exceeded the configured limit and the time of the hour is between the notification times set in settings.",
          "no": "Dette kortet trigges når det faktiske forbruket har oversteget den konfigurerte grensen og klokkeslettet er mellom varseltidspunktet satt i innstillinger."
        },
        "highlight": true,
        "tokens": [
          {
            "name": "consumption",
            "type": "number",
            "title": {
              "en": "Watt hours",
              "no": "Watt-timer"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "consumption_reset",
        "title": {
          "en": "Consumption notification reset",
          "no": "Forbruksvarsel resatt"
        },
        "hint": {
          "en": "This card triggers when the consumption notification is trigged and a new hour starts. Can be used to e.g. turn heaters back on if they were turned off by the consumption notification.",
          "no": "Dette kortet trigges når forbruksvarselet er trigget og en ny time starter. Kan f.eks brukes til å skru på varmeovner igjen, dersom de ble skrudd av pga forbruksvarselet."
        },
        "highlight": true,
        "tokens": [
          {
            "name": "previous",
            "type": "number",
            "title": {
              "en": "Previous hours consumption (Watt hours)",
              "no": "Forrige times forbruk (Watt-timer)"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "hour_reset",
        "title": {
          "en": "New hour started",
          "no": "Ny time startet"
        },
        "hint": {
          "en": "This card triggers when a new hour starts, even when no notifications have been trigged.",
          "no": "Dette kortet trigges når en ny time starter, selv uten at noen varsler har vært trigget."
        },
        "highlight": true,
        "tokens": [
          {
            "name": "previous",
            "type": "number",
            "title": {
              "en": "Previous hours consumption (Watt hours)",
              "no": "Forrige times forbruk (Watt-timer)"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "new_peak",
        "title": {
          "en": "New consumption peak",
          "no": "Ny forbrukstopp"
        },
        "hint": {
          "en": "This card triggers when a new consumption peak is registered within the current hour.",
          "no": "Dette kortet trigges når en ny forbrukstopp er registrert for den gjeldende timen."
        },
        "highlight": true,
        "tokens": [
          {
            "name": "peak",
            "type": "number",
            "title": {
              "en": "Watt",
              "no": "Watt"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "prediction_limit_reached",
        "title": {
          "en": "Prediction notification trigged",
          "no": "Estimeringsvarsel trigget"
        },
        "hint": {
          "en": "This card triggers when the predicted consumption has exceeded the configured limit and the time of the hour is between the notification times set in settings.",
          "no": "Dette kortet trigges når det estimerte forbruket har oversteget den konfigurerte grensen og klokkeslettet er mellom varseltidspunktet satt i innstillinger."
        },
        "highlight": true,
        "tokens": [
          {
            "name": "predicted",
            "type": "number",
            "title": {
              "en": "Watt hours",
              "no": "Watt-timer"
            },
            "example": {
              "en": "4000",
              "no": "4000"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "prediction_reset",
        "title": {
          "en": "Prediction notification reset",
          "no": "Estimeringsvarsel resatt"
        },
        "hint": {
          "en": "This card triggers when the predicted consumption drops below the configured limit while the prediction notification is trigged and the setting 'Reset activated' is on. It can also be set to trigger on reset due to start of a new hour in the settings (still requires predicton notification to be trigged). Can be used to e.g. turn heaters back on if they were turned off by the prediction notification.",
          "no": "Dette kortet trigges dersom det estimerte forbruket går under den konfigurerte grensen mens estimeringsvarselet er trigget og innstillingen 'Reset aktivert' er på. Det kan også bli satt til å trigge pga start av ny time i innstillinger (det krever likevel at estimeringsvarselet er trigget). Kan f.eks brukes til å skru på varmeovner igjen, dersom de ble skrudd av pga estimeringsvarselet. "
        },
        "highlight": true,
        "tokens": [
          {
            "name": "predicted",
            "type": "number",
            "title": {
              "en": "Watt hours",
              "no": "Watt-timer"
            },
            "example": {
              "en": "1500",
              "no": "1500"
            }
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      }
    ],
    "conditions": [
      {
        "id": "is_consumption_trigged",
        "title": {
          "en": "Consumption notification is !{{|not}} trigged",
          "no": "Forbruksvarsel !{{|ikke}} er trigget"
        },
        "hint": {
          "en": "This card can be used to check if the consumption notification has been trigged.",
          "no": "Dette kortet kan brukes til å sjekke om forbruksvarselet er trigget."
        },
        "highlight": true,
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      },
      {
        "id": "is_prediction_trigged",
        "title": {
          "en": "Prediction notification is !{{|not}} triggered",
          "no": "Estimeringsvarsel !{{|ikke}} er trigget"
        },
        "hint": {
          "en": "This card can be used to check if the prediction notification has been trigged.",
          "no": "Dette kortet kan brukes til å sjekke om estimeringsvarselet er trigget."
        },
        "highlight": true,
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          }
        ]
      }
    ],
    "actions": [
      {
        "id": "consumption_updated",
        "title": {
          "en": "Update consumption",
          "no": "Oppdater forbruk"
        },
        "hint": {
          "en": "Register change in consumption",
          "no": "Registrer endring i forbruk"
        },
        "titleFormatted": {
          "en": "Update consumption with [[consumption]]",
          "no": "Oppdater forbruk med [[consumption]]"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=power-of-the-hour"
          },
          {
            "name": "consumption",
            "type": "number",
            "title": {
              "en": "Watt",
              "no": "Watt"
            }
          }
        ]
      }
    ]
  },
  "drivers": [
    {
      "id": "power-of-the-hour",
      "name": {
        "en": "Power of the hour",
        "no": "Power of the hour"
      },
      "class": "sensor",
      "capabilities": [
        "meter_consumption",
        "alarm_consumption_notified",
        "meter_predictor",
        "alarm_prediction_notified",
        "meter_consumption_peak",
        "meter_consumption_previous_hour"
      ],
      "images": {
        "large": "/drivers/power-of-the-hour/assets/images/large.png",
        "small": "/drivers/power-of-the-hour/assets/images/small.png"
      },
      "icon": "/drivers/power-of-the-hour/assets/icon.svg",
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_my_devices"
          }
        },
        {
          "id": "add_my_devices",
          "template": "add_devices"
        }
      ],
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Consumption notification",
            "no": "Forbruksvarsel"
          },
          "children": [
            {
              "id": "consumption_limit",
              "type": "number",
              "label": {
                "en": "Consumption limit (Wh)",
                "no": "Forbruksgrense (Wt)"
              },
              "value": 4000,
              "min": 0,
              "step": 1,
              "hint": {
                "en": "Limit that will be used to trigger notification if the actual consumption exceeds it.",
                "no": "Grense som blir brukt til å trigge varsel dersom faktisk forbruk overstiger den."
              }
            },
            {
              "id": "notification_consumption_time_earliest",
              "type": "number",
              "label": {
                "en": "Earliest after (minutes)",
                "no": "Tidligst etter (minutter)"
              },
              "value": 0,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "If the notication is activated this is the earliest it will notify about consumption. If the limit is exceeded earlier it will not notify until it has reached these many minutes into the hour.",
                "no": "Dersom varsling er aktivert er dette det tidligste den vil varsle om forbruk. Dersom grensen overstiges tidligere vil den ikke varsle før dette antallet minutter inn i timen."
              }
            },
            {
              "id": "notification_consumption_time_latest",
              "type": "number",
              "label": {
                "en": "Latest before (minutes)",
                "no": "Senest før (minutter)"
              },
              "value": 60,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "If the notication is activated this is the latest it will notify about consumption. If the limit is exceeded later it will not notify within this hour.",
                "no": "Dersom varsling er aktivert er dette det seneste den vil varsle om forbruk. Dersom grensen overstiges senere vil den ikke varsle denne timen."
              }
            },
            {
              "id": "notification_consumption_enabled",
              "type": "checkbox",
              "label": {
                "en": "Notification enabled",
                "no": "Varsling aktivert"
              },
              "value": true,
              "hint": {
                "en": "Activates consumption notification and triggers the flow card 'Consumption notification trigged' if the predicted consumption exceeds the limit set in the setting 'Consumption limit (Wh)'.",
                "no": "Aktiverer forbruksvarsel og trigger flow-kortet 'Forbruksvarsel trigget' dersom estimert forbruk overstiger grensen satt i innstillingen 'Forbruksgrense (Wt)'."
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Prediction notification",
            "no": "Estimeringsvarsel"
          },
          "children": [
            {
              "id": "prediction_limit",
              "type": "number",
              "label": {
                "en": "Prediction limit (Wh)",
                "no": "Estimeringsgrense (Wt)"
              },
              "value": 4500,
              "min": 0,
              "step": 1,
              "hint": {
                "en": "Limit that will be used to trigger notification if the predicted consumption exceeds it.",
                "no": "Grense som blir brukt til å trigge varsel dersom estimert forbruk overstiger den."
              }
            },
            {
              "id": "notification_prediction_time_earliest",
              "type": "number",
              "label": {
                "en": "Earliest after (minutes)",
                "no": "Tidligst etter (minutter)"
              },
              "value": 30,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "If the notication is activated this is the earliest it will notify about predicted consumption. If the limit is exceeded earlier it will not notify until it has reached these many minutes into the hour.",
                "no": "Dersom varsling er aktivert er dette det tidligste den vil varsle om estimert forbruk. Dersom grensen overstiges tidligere vil den ikke varsle før dette antallet minutter inn i timen."
              }
            },
            {
              "id": "notification_prediction_time_latest",
              "type": "number",
              "label": {
                "en": "Latest before (minutes)",
                "no": "Senest før (minutter)"
              },
              "value": 60,
              "min": 0,
              "max": 60,
              "step": 1,
              "hint": {
                "en": "If the notication is activated this is the latest it will notify about estimated consumption. If the limit is exceeded later it will not notify within this hour.",
                "no": "Dersom varsling er aktivert er dette det seneste den vil varsle om estimert forbruk. Dersom grensen overstiges senere vil den ikke varsle denne timen."
              }
            },
            {
              "id": "notification_prediction_enabled",
              "type": "checkbox",
              "label": {
                "en": "Notification enabled",
                "no": "Varsling aktivert"
              },
              "value": true,
              "hint": {
                "en": "Activates prediction notification and triggers the flow card 'Prediction notification trigged' if the predicted consumption exceeds the limit set in the setting 'Prediction limit (Wh)'.",
                "no": "Aktiverer estimeringsvarsel og trigger flow-kortet 'Estimeringsvarsel trigget' dersom estimert forbruk overstiger grensen satt i innstillingen 'Estimeringsgrense (Wt)'."
              }
            },
            {
              "id": "prediction_reset_limit",
              "type": "number",
              "label": {
                "en": "Reset below (Wh)",
                "no": "Reset under (Wt)"
              },
              "value": 3500,
              "min": 0,
              "step": 1,
              "hint": {
                "en": "Resets the prediction notification if the predicted consumption drops below this limit after the notification has been trigged. Note that this functionality is enabled by the setting 'Reset activated'.",
                "no": "Resetter estimeringsvarsel dersom estimert forbruk synker under denne grensen etter at varselet har blitt trigget. Merk at denne funksjonaliteten aktiveres av innstillingen 'Reset aktivert'."
              }
            },
            {
              "id": "prediction_reset_enabled",
              "type": "checkbox",
              "label": {
                "en": "Reset activated",
                "no": "Reset aktivert"
              },
              "value": true,
              "hint": {
                "en": "Resets the prediction notification and triggers the flow card 'Prediction notification reset' if the predicted consumptions drops below the 'Reset below (Wh)' limit.",
                "no": "Resetter estimeringsvarselet og trigger flow-kortet 'Estimertingsvarsel resatt' dersom det estimerte forbruket går under 'Reset under (Wt)' grensen."
              }
            },
            {
              "id": "prediction_reset_new_hour_enabled",
              "type": "checkbox",
              "label": {
                "en": "Notify reset on new hour",
                "no": "Varsle reset ved ny time"
              },
              "value": false,
              "hint": {
                "en": "Triggers the flow card 'Prediction notification reset' when a new hour starts (requires that the prediction notification is trigged). It will then report a estimated consumption of 0 (zero).",
                "no": "Trigger flow-kortet 'Estimertingsvarsel resatt' når en ny time starter (krever at estimeringsvarselet er trigget). Den vil da rapportere om et estimert forbruk på 0 (null)."
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Advanced",
            "no": "Avansert"
          },
          "children": [
            {
              "id": "prediction_type",
              "type": "dropdown",
              "label": {
                "en": "Prediction method",
                "no": "Estimeringsmetode"
              },
              "value": "time",
              "values": [
                {
                  "id": "time",
                  "label": {
                    "en": "Age (minutes)",
                    "no": "Alder (minutter)"
                  }
                },
                {
                  "id": "count",
                  "label": {
                    "en": "Count",
                    "no": "Antall"
                  }
                }
              ],
              "hint": {
                "en": "Select if the predictions should be done based on age of readings or a specific amount of readings.",
                "no": "Velg om estimeringen skal gjøres basert på alder av avlesninger eller et spesifikt antall avlesninger."
              }
            },
            {
              "id": "prediction_age",
              "type": "number",
              "label": {
                "en": "Prediction",
                "no": "Estimering"
              },
              "value": 5,
              "min": 1,
              "max": 1000,
              "step": 1,
              "hint": {
                "en": "Maximum age or amount of readings which are used for predicting the consumption.",
                "no": "Maksimale alderen eller antall av målinger som brukes for estimere forbruk."
              }
            },
            {
              "id": "prediction_history_count",
              "type": "number",
              "label": {
                "en": "History",
                "no": "Historikk"
              },
              "value": 100,
              "min": 0,
              "max": 1000,
              "hint": {
                "en": "Maximum amount of readings stored (used for prediction calculations). Example with storing 360 readings: If your device is updating every 5 seconds you would be able to predict based on 30 minutes of history. 5 seconds * 360  = 1800 seconds = 30 minutes.",
                "no": "Maksimalt antall avlesninger som lagres (brukt i estimeringskalkulasjoner). Eksempel med lagring av 360 avlesninger: Dersom enheten din oppdaterer hvert 5 sekund vil du kunne estimere basert på 30 minutters historikk. 5 sekund * 360  = 1800 sekunder = 30 minutter."
              }
            }
          ]
        }
      ]
    }
  ],
  "capabilities": {
    "alarm_consumption_notified": {
      "title": {
        "en": "Consumption notification trigged",
        "no": "Forbruksvarsel trigget"
      },
      "desc": {
        "en": "Consumption notification has been trigged",
        "no": "Forbruksvarsel har blitt trigget"
      },
      "type": "boolean",
      "getable": true,
      "setable": false,
      "greyout": true,
      "insights": true,
      "icon": "/assets/alert.svg",
      "insightsTitleTrue": {
        "en": "Consumption notification trigged",
        "no": "Forbruksvarsel trigget"
      },
      "insightsTitleFalse": {
        "en": "Consumption notification reset",
        "no": "Forbruksvarsel resatt"
      }
    },
    "alarm_prediction_notified": {
      "title": {
        "en": "Prediction notification trigged",
        "no": "Estimeringsvarsel trigget"
      },
      "desc": {
        "en": "Prediction notification has been trigged",
        "no": "Estimeringsvarsel har blitt trigget"
      },
      "type": "boolean",
      "getable": true,
      "setable": false,
      "greyout": true,
      "insights": true,
      "icon": "/assets/alert.svg",
      "insightsTitleTrue": {
        "en": "Predicted consumption notification trigged",
        "no": "Estimeringsvarsel trigget"
      },
      "insightsTitleFalse": {
        "en": "Predicted consumption notification reset",
        "no": "Estimeringsvarsel resatt"
      }
    },
    "meter_consumption": {
      "title": {
        "en": "Consumption this hour",
        "no": "Forbruk denne timen"
      },
      "desc": {
        "en": "Shows total consumption so far this hour",
        "no": "Viser totalt forbruk så langt denne timen"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt hours",
            "no": "Watt-timer"
          },
          "example": {
            "en": 1200,
            "no": 1200
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "Wh",
        "no": "Wt"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/average.svg",
      "insights": true
    },
    "meter_consumption_peak": {
      "title": {
        "en": "Peak this hour",
        "no": "Topp denne timen"
      },
      "desc": {
        "en": "Shows highest registered consumption peak within this hour",
        "no": "Viser høyeste registrerte forbrukstopp denne timen"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt",
            "no": "Watt"
          },
          "example": {
            "en": 1200,
            "no": 1200
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "W",
        "no": "W"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/maximum.svg"
    },
    "meter_consumption_previous_hour": {
      "title": {
        "en": "Consumption previous hour",
        "no": "Forbruk forrige time"
      },
      "desc": {
        "en": "Shows previous hours total consumption",
        "no": "Viser forrige times totale forbruk"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt hours",
            "no": "Watt-timer"
          },
          "example": {
            "en": 4500,
            "no": 4500
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "Wh",
        "no": "Wt"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/previous.svg"
    },
    "meter_predictor": {
      "title": {
        "en": "Predicted consumption",
        "no": "Estimert forbruk"
      },
      "desc": {
        "en": "Shows total predicted consumption for this hour based on history",
        "no": "Viser totalt estimert forbruk for denne timen basert på historikk"
      },
      "tokens": [
        {
          "name": "value",
          "title": {
            "en": "Watt hours",
            "no": "Watt-timer"
          },
          "example": {
            "en": 1200,
            "no": 1200
          }
        }
      ],
      "type": "number",
      "min": 0,
      "decimals": 0,
      "units": {
        "en": "Wh",
        "no": "Wt"
      },
      "getable": true,
      "setable": false,
      "greyout": true,
      "icon": "/assets/predicted.svg",
      "insights": true
    }
  }
}